image: docker

stages:
  - build
  - test
  - cleanup
  - deploy


build_job:
  stage: build
  script:
    - ci/nginx_build

test_job:
  stage: test
  script:
    - docker run -p 80:80 -d --name nginx evild/alpine-nginx
    - docker ps | grep nginx

cleanup:
  stage: cleanup
  script:
    - docker rm -f $(docker ps -aq)


deploy_job:
  stage: deploy
  script:
    - git push --mirror https://$GITHUB_TOKEN@github.com/Evild67/docker-alpine-nginx.git
